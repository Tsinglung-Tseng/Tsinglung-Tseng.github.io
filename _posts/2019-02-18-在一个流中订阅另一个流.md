```python
import rx
import rx.operators as ops
from rx.subjects import Subject

"""
有两个流，一个负责监听任务队列，一旦有任务完成则返回任务id。
另一个负责提交任务，并在提交之后立即订阅完成任务的流。
这时就需要在第二个流中订阅第一个。
"""

completed = Subject()
completed.subscribe(lambda sid: print(f"JOB {sid} DONE"))

completed.on_next([30])
# completed.on_next([30])

task_id = rx.of(30)
task_result = task_id.pipe(ops.flat_map(lambda sid: completed.pipe(ops.filter(lambda cids: sid in cids), 
                                                                   ops.map(lambda _: f"Task {sid} Done"))))

task_result.subscribe(print, print)

completed.on_next([30])
# JOB [30] DONE
# Task 30 Done
```